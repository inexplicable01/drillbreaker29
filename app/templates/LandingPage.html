<!DOCTYPE html>
<html>
<head>
    <title>DrillBreakerApp</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            text-align: center; /* Centers text for all elements */
        }

        .center-table {
            margin-left: auto;
            margin-right: auto;
            border-collapse: collapse; /* Collapse the border */
            width: 50%; /* Adjust the width as needed */
            border: 2px solid black; /* Adjust the border width and color as needed */
        }

        td {
            padding: 10px; /* Adjust the padding as needed */
            border: 1px solid black; /* Adds a border to each table cell */
        }

        form {
            display: inline-block; /* Keeps the form dimensions to its content */
        }
    </style>
</head>
<body>
<h1>Welcome to Wayber Real Estate Analysis</h1>

{#        <a href="/beaman">be</a>#}
{#        <a href="/showdb">showdbafdsf</a>#}

<table class="center-table" style="border-collapse: collapse; width: 50%;">
    {#  <tr>#}
    {#    <td>New Listing goes and fetch these areas (Bellevue, Kenmore, Bothell, Kirkland): for new Listings</td>#}
    {#    <td><a href="/newlistings">New Listings</a></td>#}
    {#  </tr>#}
    {#      <tr>#}
    {#        <td>Below Link Show a Heat Map of Homes Sold</td>#}
    {#        <td><a href="/heatmapexample">Homes Sold Heat Map</a></td>#}
    {#      </tr>#}
{#    <tr>#}
{#        <td>Potential Map Value</td>#}
{#        <td><a href="{{ url_for('hothomes_bp.MapPotentialValue') }}">Potential Map Value</a></td>#}
{#    </tr>#}
    {#  <tr>#}
    {#    <td>Where are high Value places to build?</td>#}
    {#    <td><a href="/wheretobuild">Where to Build</a></td>#}
    {#  </tr>#}
    {#      <tr>#}
    {#    <td>Where are the water front properties</td>#}
    {#    <td><a href="/waterfrontproperties">Waterfront props</a></td>#}
    {#  </tr>#}
    {#          <tr>#}
    {#    <td>Model Error</td>#}
    {#    <td><a href="/errormap">Model Error</a></td>#}
    {#  </tr>#}

    {#          <tr>#}
    {#    <td>Comparison Template</td>#}
    {#    <td><a href="/comparison_base">Comparison</a></td>#}
    {#  </tr>#}
    {#          <tr>#}
    {#    <td>New Listing</td>#}
    {#    <td><a href="/new_listing">New Listing</a></td>#}
    {#  </tr>#}
    {#          <tr>#}
    {#    <td>New Listing in Ballard/Fremont</td>#}
    {#    <td><a href="/new_listing_in_selectneighbourhood">New Listing</a></td>#}
    {#  </tr>#}

    {#          <tr>#}
{#    <td>Openhouse</td>#}
{#    <td><a href="{{ url_for('openhouse.SearchForOpenHouseRoute') }}">Open House</a></td>#}
{#    </tr>#}
{#    <td>Homes for Sale</td>#}
{#    <td><a href="{{ url_for('hothomes_bp.forsalehomes') }}">Homes for Sale</a></td>#}
{#    </tr>#}
    <td>Area Report</td>
    <td><a href="{{ url_for('soldhomes_bp.AreaReport') }}">Area Report</a></td>
    </tr>
        <td>Area Numbering</td>
    <td><a href="{{ url_for('zones.customer_zones_map') }}">Area Numbering</a></td>
    </tr>
        <td>Investment Analysis</td>
    <td><a href="{{ url_for('investmentclients_bp.table') }}">Investment Analysis</a></td>
    </tr>
{#        </tr>#}
{#    <td>Area Report</td>#}
{#    <td><a href="{{ url_for('soldhomes_bp.AreaReportFor_sale') }}">Area Report</a></td>#}
{#    </tr>#}

{#    <td>Top Homes in North Seattle</td>#}
{#    <td><a href="{{ url_for('hothomes_bp.showHotHomes') }}">Hot Homes</a></td>#}
{#    </tr>#}

{#    <td>Neighbourhood Report</td>#}
{#    <td><a href="{{ url_for('neighbourhoodreport.neigh_report') }}">Neighbourhood Report</a></td>#}
{#    </tr>#}

{#    <td>Clickable Map</td>#}
{#    <td><a href="{{ url_for('clickablemap_bp.clickablemap') }}">Clickable Map</a></td>#}
{#    </tr>#}
{#    <td>Clickable Map2</td>#}
{#    <td><a href="{{ url_for('clickablemap_bp.clickablemap2') }}">Clickable Map2</a></td>#}
{##}
{#    </tr>#}

    <td>FSBO</td>
    <td><a href="{{ url_for('fsbo_bp.getfsbo') }}">FSBO</a></td>
    </tr>

    <td>Transaction High Level Summary</td>
    <td><a href="{{ url_for('zonestats_interesting.monthlytrends') }}">Transactions by City</a></td>
    </tr>
{#    </tr>#}
    <td>Customer Interest</td>
    <td><a href="{{ url_for('customer_interest_bp.listCustomers') }}">Custom Analysis</a></td>
    </tr>
    <td>The Dirty Scoop</td>
    <td><a href="{{ url_for('dirty_scoop_bp.index') }}">Dirty Scoop</a></td>
        </tr>
        <td>Zones Creation</td>
    <td><a href="{{ url_for('zones.new_zone') }}">Zones Creation</a></td>
        </tr>

{#    <td>Set Alerts</td>#}
{#    <td><a href="{{ url_for('customer_interest_bp.listCustomersforAlerts') }}">Customer Interest Homes</a></td>#}
{#    </tr>#}

</table>


<p>This is last update on {{ lastupdate }}</p>
<p>{{ recent_pending_count }} went pending in the last 7 days.</p>


<hr>

<h2>BriefListing Repair Tool</h2>
<div id="repair-tool">
    <input
        type="text"
        id="repair-zpid"
        style="width: 40%; padding: 6px;"
        placeholder="Enter zpid (e.g., 12345678)"
    />
    <button id="repair-btn" style="padding: 6px 12px; margin-left: 4px;">
        Repair BriefListing
    </button>

    <div id="repair-status" style="margin-top: 10px; font-weight: bold;"></div>

    <pre id="repair-result"
         style="text-align: left; margin: 10px auto; width: 80%; max-height: 300px; overflow: auto; border: 1px solid #ccc; padding: 8px;">
    </pre>
</div>

<hr>

<h2>Zillow Address Tester</h2>
<div id="zillow-tester">
    <input
        type="text"
        id="zillow-address"
        style="width: 60%; padding: 6px;"
        placeholder="123 Main St, Seattle, WA 98101"
    />
    <button id="zillow-search-btn" style="padding: 6px 12px; margin-left: 4px;">
        Search Zillow
    </button>

    <div id="zillow-status" style="margin-top: 10px; font-weight: bold;"></div>

    <pre id="zillow-result"
         style="text-align: left; margin: 10px auto; width: 80%; max-height: 400px; overflow: auto; border: 1px solid #ccc; padding: 8px;">
    </pre>
</div>

<script>
    $(function () {
        // BriefListing Repair Tool
        $("#repair-btn").on("click", function () {
            const zpid = $("#repair-zpid").val().trim();
            if (!zpid) {
                $("#repair-status").text("Please enter a zpid.");
                $("#repair-result").text("");
                return;
            }

            $("#repair-status").text("Repairing...");
            $("#repair-result").text("");

            $.ajax({
                url: "/maintanance/repairBriefListing",
                method: "POST",
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify({ zpid: zpid }),
                success: function (data) {
                    if (data.status === "success") {
                        $("#repair-status").text("✓ Success! BriefListing repaired.");
                        $("#repair-result").text(JSON.stringify(data, null, 2));
                    } else {
                        $("#repair-status").text("⚠ " + data.message);
                        $("#repair-result").text(JSON.stringify(data, null, 2));
                    }
                },
                error: function (xhr) {
                    let msg = "Error repairing BriefListing";
                    try {
                        const resp = JSON.parse(xhr.responseText);
                        if (resp.message) {
                            msg += ": " + resp.message;
                        }
                    } catch (e) {
                        // ignore parse errors
                    }
                    $("#repair-status").text(msg);
                    $("#repair-result").text(xhr.responseText || "");
                }
            });
        });

        // Zillow Address Tester
        $("#zillow-search-btn").on("click", function () {
            const address = $("#zillow-address").val().trim();
            if (!address) {
                $("#zillow-status").text("Please enter an address.");
                $("#zillow-result").text("");
                return;
            }

            $("#zillow-status").text("Loading...");
            $("#zillow-result").text("");

            $.ajax({
                url: "{{ url_for('main.api_zillow_search_by_address') }}",  // <-- updated
                method: "POST",
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify({ address: address }),
                success: function (data) {
                    $("#zillow-status").text("Success!");
                    $("#zillow-result").text(JSON.stringify(data, null, 2));
                },
                error: function (xhr) {
                    let msg = "Error calling API";
                    try {
                        const resp = JSON.parse(xhr.responseText);
                        if (resp.error) {
                            msg += ": " + resp.error;
                        }
                    } catch (e) {
                        // ignore parse errors
                    }
                    $("#zillow-status").text(msg);
                    $("#zillow-result").text(xhr.responseText || "");
                }
            });
        });
    });
</script>

</body>
</html>
